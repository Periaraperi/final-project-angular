<h1>Search for Books:</h1>

<div>
  <h2>Test Things Here:</h2>
  <button (click)="onFetchWork()">Fetch Work:</button>
  <div *ngIf="work$ | async as work">
    <p>{{work.key}}</p>
    <p>{{work.title}}</p>
    <p *ngIf="work.description">
      {{work.description}}
    </p>

    <div *ngFor="let s of work.subjects">
      <p>{{s}}</p>
    </div>
    <img [src]="'https://covers.openlibrary.org/b/id/' + work.covers[0] + '-M.jpg'">
  </div>

  <button (click)="onGetEditons()">Editions</button>
  <div *ngIf="editions$ | async as editions">
    <div *ngFor="let ed of editions.entries; let i=index" style="border:3px solid black; margin:10px;">
      INDEX: {{i}}
      <p *ngIf="!ed.authors"> <b>NO AUTHORS</b> </p>
      <div *ngIf="ed.authors">
        <button (click)="onGetAuthorData(ed.authors,i)">Get Author Data</button>
        <div *ngIf="authors[i] | async as authors">
          <p>Authors Data</p>
          <div *ngFor="let a of authors; let authorId=index;">
            {{authorId}} <br>
            {{a.name}} <br>
            {{a.birth_date}} <br>
            {{a.bio}} <br>
          </div>
        </div>
      </div>

      <p>{{ed.key}}</p>
      <p>Title: {{ed.title}}</p>
      <p *ngIf="ed.pagination">Pagination: {{ed.pagination}}</p>
      <p *ngIf="ed.number_of_pages">Pages: {{ed.number_of_pages}}</p>
      <p *ngIf="ed.publish_date">Publish Date: {{ed.publish_date}}</p>
      <div *ngIf="ed.publishers">
        Publishers:
        <div *ngFor="let pub of ed.publishers">
          <p>{{pub}}</p>
        </div>
      </div>
      <img *ngIf="ed.covers && ed.covers[0]!==-1; else noPic" [src]="'https://covers.openlibrary.org/b/id/' + ed.covers[0] + '-M.jpg'">
      <ng-template #noPic> <b>NO COVER</b> </ng-template>
    </div>
  </div>
</div>

<div [formGroup]="form">
  <select formControlName="searchBy">
    <option *ngFor="let o of options"> {{o}} </option>
  </select>
  <input type="text" placeholder="search..." formControlName="searchBar">
  <button (click)="onSearch()" [disabled]="form.invalid"> Search </button>
</div>


<div>
  <h3>Result of Search by title or query</h3>
  <div *ngIf="worksFromDocs$ | async as allWorks; else waiting">
    <div *ngIf="allWorks.length===0">Could not find anything :(</div>
    <div *ngFor="let w of allWorks" style="border:3px solid black; margin:5px;">
      <p><b>KEY:</b> {{w.key}}</p>
      <p><b>Title:</b> {{w.title}}</p>
      <p *ngIf="w.description"><b>DESCRIPTION:</b> {{w.description}}</p>
      <div *ngIf="w.covers && w.covers.length>=1 && w.covers[0]!==-1; else noCover">
        <img [src]="'https://covers.openlibrary.org/b/id/' + w.covers[0] + '-M.jpg'">
      </div>
      <ng-template #noCover><b>NO COVER!!!</b></ng-template>
    </div>
  </div>
  <ng-template #waiting>trualobs kaci</ng-template>
</div>

<app-search-result [book$]="bookToOutput$" [books$]="booksByTitle$"></app-search-result>
